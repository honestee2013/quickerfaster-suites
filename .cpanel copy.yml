deployment:
  tasks:
    # Paths
    - export COMPOSER_BIN=/home/quickerf/composer.phar
    # - export REPOPATH=/home/quickerf/laravel_suites_repo/suites.quickerfaster.com
    # - export DEPLOYPATH=/home/quickerf/public_html/suites.quickerfaster.com
    - export REPOPATH=/home/quickerf/laravel_suites_repo/progressive-saas
    - export DEPLOYPATH=/home/quickerf/public_html/progressive
    - export LOGDIR=/home/quickerf/deploy_logs
    - mkdir -p $LOGDIR
    - export LOGFILE=$LOGDIR/deploy_$(date +"%Y-%m-%d_%H-%M-%S").log

    # Start log
    - /bin/echo "======= Deployment started at $(date) =======" >> $LOGFILE





        # 1. Clean deployment area (but keep vendor if exists)
    - rm -rf $DEPLOYPATH/app $DEPLOYPATH/bootstrap $DEPLOYPATH/config $DEPLOYPATH/database $DEPLOYPATH/public $DEPLOYPATH/resources $DEPLOYPATH/routes $DEPLOYPATH/storage $DEPLOYPATH/tests $DEPLOYPATH/vendor >> $LOGFILE 2>&1

    # 2. Copy ALL project files (not just public)
    - cp -r * $DEPLOYPATH/ 2>/dev/null || true
    - cp -r .* $DEPLOYPATH/ 2>/dev/null || true

    # 3. Remove files that shouldn't be in public
    - rm -rf $DEPLOYPATH/.git $DEPLOYPATH/.cpanel.yml $DEPLOYPATH/README.md >> $LOGFILE 2>&1

    # 4. Set permissions
    - chmod -R 755 $DEPLOYPATH/storage $DEPLOYPATH/bootstrap/cache >> $LOGFILE 2>&1

    # 5. Update .env for subdirectory
    - echo "APP_URL=https://quickerfaster.com/progressive" > $DEPLOYPATH/.env
    - echo "ASSET_URL=https://quickerfaster.com/progressive" >> $DEPLOYPATH/.env
    - echo "APP_NAME=ProgressiveSaaS" >> $DEPLOYPATH/.env
    - echo "APP_ENV=production" >> $DEPLOYPATH/.env
    - echo "APP_DEBUG=true" >> $DEPLOYPATH/.env

    # Database config (use your existing)
    - echo "DB_CONNECTION=mysql" >> $DEPLOYPATH/.env
    - echo "DB_HOST=localhost" >> $DEPLOYPATH/.env
    - echo "DB_PORT=3306" >> $DEPLOYPATH/.env
    - echo "DB_DATABASE=your_database" >> $DEPLOYPATH/.env
    - echo "DB_USERNAME=your_username" >> $DEPLOYPATH/.env
    - echo "DB_PASSWORD=your_password" >> $DEPLOYPATH/.env

    # 6. Run Composer install if vendor doesn't exist
    - if [ ! -d "$DEPLOYPATH/vendor" ]; then
        echo "Installing Composer dependencies..." >> $LOGFILE
        cd $DEPLOYPATH && composer install --no-dev --optimize-autoloader >> $LOGFILE 2>&1
      fi

    # 7. Clear caches
    - cd $DEPLOYPATH && php artisan config:clear >> $LOGFILE 2>&1
    - cd $DEPLOYPATH && php artisan route:clear >> $LOGFILE 2>&1
    - cd $DEPLOYPATH && php artisan view:clear >> $LOGFILE 2>&1

    - echo "=== Deployment Complete ===" >> $LOGFILE
